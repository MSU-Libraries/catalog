<?php
  $toggleUrl = ($this->facet['isApplied'] || $this->facet['isExcluded'])
    ? $this->urlBase . $this->url->removeFacet($this->group, $this->facet['value'], $this->facet['operator'])
    : $this->urlBase . $this->url->addFacet($this->group, $this->facet['value'], $this->facet['operator']);

  $hasCheckbox = $this->facet['operator'] === 'OR';
  // MSU never show checkbox
  $hasCheckbox = false;

  $classList = ['facet', 'js-facet-item'];
  if ($this->facet['isApplied']) {
    $classList[] = 'active';
  }
  if ($this->facet['isExcluded']) {
    $classList[] = 'excluded';
  }
  if ($this->facet['operator'] == 'OR') {
    $classList[] = 'facetOR';
  }
  if ($this->facet['operator'] == 'AND') {
    $classList[] = 'facetAND';
  }
  $displayText = '';
  if ($this->facet['isExcluded']) {
    $displayText = '<span class="visually-hidden">' . $this->transEsc('excluded') . '</span> ';
  }
  if ('' !== (string)($this->facet['displayText'] ?? '')) {
    $displayText .= $this->escapeHtml($this->facet['displayText']);
  } elseif ('' !== (string)($this->facet['value'] ?? '')) {
    $displayText .= $this->escapeHtml($this->facet['value']);
  } else {
    $displayText .= '-';
  }
  $displayText = '<span class="facet-value' . ($hasCheckbox ? ' icon-link__label' : '') . '">' . $displayText . '</span>';

  if ($hasCheckbox) {
    $displayText = $this->icon(
        $this->facet['isApplied'] ? 'facet-checked' : 'facet-unchecked',
        [
          'class' => 'icon-link__icon',
          'data-checked' => $this->facet['isApplied'] ? 'true' : 'false',
        ]
    ) . $displayText;
  }
?>

<span class="<?=implode(' ', $classList) ?>">
  <a class="main-link<?=$hasCheckbox ? ' icon-link' : ''?>" href="<?=$toggleUrl ?>" data-lightbox-ignore data-title="<?=$this->escapeHtmlAttr($this->facet['displayText']) ?>" data-count="<?=$this->facet['count'] ?>"<?php if ($this->facet['isApplied']): ?> title="<?=$this->transEscAttr('applied_filter') ?>"<?php endif;?>>
    <span class="text">
      <?=$displayText ?>
    </span>
    <?php if (!$this->facet['isApplied'] && !$this->facet['isExcluded'] && null !== $this->facet['count']): ?>
      <span class="badge">
        <?php $currentCount = $this->localizedNumber($this->facet['count']); ?>
        <span class="visually-hidden"><?=$this->transEsc('result_count', ['%%count%%' => $currentCount]) ?></span>
        <span aria-hidden="true"><?=$currentCount ?></span>
      </span>
    <?php endif; ?>
  </a>
  <?php if ($this->exclude && !$this->facet['isApplied'] && !$this->facet['isExcluded']): ?>
    <?php $excludeURL = $this->urlBase . $this->url->addFacet($this->group, $this->facet['value'], 'NOT'); ?>
    <a href="<?=$excludeURL ?>" data-lightbox-ignore class="exclude" title="<?=$this->transEscAttr('exclude_facet') ?>" rel="nofollow"><?php /** MSU */ ?>>
      <?=$this->icon('facet-exclude') ?>
      <span class="visually-hidden"><?=$this->transEsc('exclude_facet') ?></span>
    </a>
  <?php endif; ?>
</span>
