<?php
$selected = '';
foreach ($this->statusItems as $item) {
  if ($selected == '') {
    $selected = $item;
  } else if ($selected['status'] != 'Available') {
    if ($item['status'] == 'Available' || ($selected['status'] != 'Restricted' && $item['status'] == 'Restricted'))
      $selected = $item;
  }
}
if ($selected != '') {
  $status = $selected['status'];
  $location = $selected['location'];
  $callnumber = $selected['callnumber'];
  if (in_array($status, array('Aged to lost', 'Claimed returned', 'Declared lost', 'In process (non-requestable)',
      'Long missing', 'Lost and paid', 'Missing', 'On order', 'Order closed', 'Unknown', 'Withdrawn')))
    $status = 'Unavailable';
  else if (in_array($status, array('Awaiting pickup', 'Awaiting delivery', 'In transit', 'Paged', 'Checked out')))
    $status = 'Checked Out';
  else if ($status == 'Restricted')
    $status = 'Lib Use Only';
  else if (!in_array($status, array('Available', 'Unavailable')))
    $status = 'Unknown status';
}
?>
<?php if ($selected != ''): ?>
  <strong>Holdings:</strong>
  <span class="fullAvailability">
    <?php if ($selected['availability']): ?>
      <strong class="text-success"><?=($selected['reserve'] == 'Y') ? $this->transEsc("On Reserve") : $this->transEsc("Available")?></strong>
    <?php elseif ($status == 'Lib Use Only'): ?>
      <strong class="text-warning"><?=$this->transEsc($status)?></strong>
    <?php else: ?>
      <strong class="text-danger"><?=$this->transEsc($status)?></strong>
    <?php endif; ?>
  </span>
  <?php if ($location != ''): ?>
    at
    <span class="fullLocation">
      <?php $locationText = $this->transEscWithPrefix('location_', explode(" - ", $location)[0]); ?>
      <?php if ($selected['locationhref'] ?? false): ?>
        <a href="<?=$selected['locationhref']?>" target="_blank"><?=$locationText?></a>
      <?php else: ?>
        <?=$locationText?>
      <?php endif; ?>
    </span>
  <?php endif; ?>
  <?php if ($callnumber != ''): ?>
    ; CN
    <span class="fullCallnumber">
      <?php if ($this->callnumberHandler): ?>
        <a href="<?=$this->url('alphabrowse-home') ?>?source=<?=$this->escapeHtmlAttr($this->callnumberHandler) ?>&amp;from=<?=$this->escapeHtmlAttr($callnumber) ?>"><?=$this->escapeHtml($callNumPrefix)?><?=$this->escapeHtml($callnumber)?></a>
      <?php else: ?>
        <?=$this->escapeHtml($callNumPrefix)?><?=$this->escapeHtml($callnumber)?>
      <?php endif; ?>
    </span>
  <?php endif; ?>
<?php else: ?>
  <span class="fullAvailability"><strong class="text-danger">Unavailable</strong></span>
<?php endif; ?>
