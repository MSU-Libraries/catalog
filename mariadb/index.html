
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../solr/">
      
      
        <link rel="next" href="../traefik/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>MariaDB - MSU Libraries Public Catalog Technical Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mariadb" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MSU Libraries Public Catalog Technical Documentation" class="md-header__button md-logo" aria-label="MSU Libraries Public Catalog Technical Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MSU Libraries Public Catalog Technical Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MariaDB
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/MSU-Libraries/catalog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    MSU-Libraries/catalog
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MSU Libraries Public Catalog Technical Documentation" class="md-nav__button md-logo" aria-label="MSU Libraries Public Catalog Technical Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MSU Libraries Public Catalog Technical Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MSU-Libraries/catalog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    MSU-Libraries/catalog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tech-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Technical Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../first-time-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    First Time Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../harvesting-and-importing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Harvesting &amp; Importing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CICD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CI/CD
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Administration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Administration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../general/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    General
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backup-and-restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup &amp; Restore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upgrading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Upgrading
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vufind/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VuFind
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../solr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Solr
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    MariaDB
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    MariaDB
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#helpers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Helpers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#re-deploying" class="md-nav__link">
    <span class="md-ellipsis">
      
        Re-deploying
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restarting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Restarting
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#restoring-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Restoring the cluster
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verifying-cluster-health" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verifying cluster health
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-grastatedat-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        The grastate.dat File
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-break-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to break the cluster
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../traefik/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Traefik
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring App
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../load-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Load Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helper-scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Helper Scripts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bots
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../job-schedules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Job Schedules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Developing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Developing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Writing &amp; Running Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-vufind/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using Core VuFind Only
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alphabrowse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alphabrowse Internals
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Processes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Processes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../communication-processes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Communication Processes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#helpers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Helpers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#re-deploying" class="md-nav__link">
    <span class="md-ellipsis">
      
        Re-deploying
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restarting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Restarting
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#restoring-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Restoring the cluster
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verifying-cluster-health" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verifying cluster health
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-grastatedat-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        The grastate.dat File
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-break-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to break the cluster
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="mariadb">MariaDB</h1>
<h2 id="helpers">Helpers</h2>
<p>To quick-connect to the database within the container (without having to look
up the password from the Docker secret or CI variable), simply use the
<code>connect</code> command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span><span class="nv">name</span><span class="o">=</span>catalog-prod-mariadb_galera<span class="k">)</span><span class="w"> </span>connect
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="c1"># Or:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>pc-connect<span class="w"> </span>catalog-prod-mariadb_galera
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># Then once in the container, run:</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>connect
</code></pre></div>
<h2 id="re-deploying">Re-deploying</h2>
<p>If you ever need to re-deploy the stack, you can use the
<a href="../helper-scripts/#deploy-helper-pc-deploy">pc-deploy</a> script.</p>
<p>You can run it as either <code>sudo</code> or the <code>deploy</code> user
(the script will have the Docker command run as the <code>deploy</code> user either way).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sudo<span class="w"> </span>pc-deploy<span class="w"> </span>catalog-prod<span class="w"> </span>mariadb-cloud
</code></pre></div>
<h2 id="restarting">Restarting</h2>
<p>If you need to restart the Galera cluster, the easiest method is to re-run
the CI job that deploys the DB updates. But alternatively, you can restart
the containers one-by-one. Just wait for the restarted container to be
"healthy" before restarting the next.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Run the stop command to force a new container to be created</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>docker<span class="w"> </span>stop<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span><span class="nv">name</span><span class="o">=</span>catalog-prod-mariadb_galera<span class="k">)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="c1"># Wait for the new container to report healthy</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>watch<span class="w"> </span><span class="s1">&#39;docker ps | grep catalog-prod-mariadb_galera&#39;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="c1"># Now repeat those two steps on the remaining nodes in the cluster</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="c1"># Once complete, run a final check on the cluster</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>sudo<span class="w"> </span>/usr/local/ncpa/plugins/check_galera.sh<span class="w"> </span>catalog-prod
</code></pre></div>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="restoring-the-cluster">Restoring the cluster</h3>
<p>In the event of the database getting de-clustered, where the nodes are
unable to bootstrap themselves, you will need to manually determine which
node should be started up first and be the one with the most up-to-date
source of data.</p>
<ul>
<li>To do this, first remove the database stack so that all the containers
  can be stopped as gracefully as possible.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nv">STACK_NAME</span><span class="o">=</span>catalog-prod
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>docker<span class="w"> </span>stack<span class="w"> </span>rm<span class="w"> </span><span class="nv">$STACK_NAME</span>-mariadb
</code></pre></div>
<ul>
<li>Then look at the MariaDB volume data on each of the nodes to determine
  which had the latest timestamps on its files across all the nodes. This
  can vary on a file-by-file basis, but generally there should be a node
  that is more ahead than others or a table that is more important than
  others and is more up-to-date (i.e. user data vs session data).
  This step can be tricky since some of the files may have more current
  timestamps on one node, but then one other node may have the most current
  timestamp for another particular file. Use your best judgement here.
  Generally the top level files are more important (the galera state files
  and binary logs where it tracks changes), but you also don't want to lose
  data from the <code>vufind</code> database.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Run these on all of your nodes as root and compare timestamps</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nv">STACK_NAME</span><span class="o">=</span>catalog-prod
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>sudo<span class="w"> </span>-s<span class="w"> </span><span class="c1"># root is required to view Docker volume data</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="nb">cd</span><span class="w"> </span>/var/lib/docker/volumes/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-mariadb_db-bitnami/_data/mariadb/data
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1"># Particular file to look at would be (in general order of importance):</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="c1"># grastate.dat, gvwstate.dat, mysql-bin*</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>ls<span class="w"> </span>-ltr<span class="w"> </span>./
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="c1"># Key files (tables) here are (in general order of importance):</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="c1"># change_tracker.ibd, user.ibd, user_list.ibd</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>ls<span class="w"> </span>-ltr<span class="w"> </span>vufind
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="c1"># If the timestamps are too similar,</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="c1"># try using `stat` to get a more accurate time!</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>stat<span class="w"> </span>grastate.dat
</code></pre></div>
<ul>
<li>Once you have a node number you want to use as your source of truth, first
  take a backup of that volume data. This is in case the recovery goes wrong
  (for example, you bring up your node, then realize you wanted to use another
  node and switch to the other one, then the sync happens and you end up with
  two nodes without data).</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nv">STACK_NAME</span><span class="o">=</span>catalog-prod
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c1"># Remove the -n flag if the dry-run looks good</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>rsync<span class="w"> </span>-ain<span class="w"> </span>/var/lib/docker/volumes/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-mariadb_db-bitnami/_data/mariadb/data/<span class="w"> </span>/tmp/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>_mariadb_backup_<span class="k">$(</span>date<span class="w"> </span>-I<span class="k">)</span>/
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<div class="admonition note">
<p class="admonition-title">Restoring from the backup</p>
<p>If you need to use this backup, for example, if you loose data on multiple nodes,
remove the stack again then run the rsync command in the opposite direction to
restore the files back to their volume and run the below steps again to force
bootstrap the cluster with that node.</p>
</div>
<ul>
<li>
<p>Now we're ready to start recovering the cluster from the selected node by
  updating the
  <code>/home/deploy/${STACK_NAME}/docker-compose.mariadb-cloud-force.yml</code>
  file located on node 1 in the cluster, and setting the
  <code>"node.labels.nodeid==N"</code> to change the <code>N</code> to
  your node number, i.e. a value 1-3. Then also update the
  <code>max_replicas_per_node</code> to <code>1</code> to indicate that you're ready to deploy.</p>
</li>
<li>
<p>Now we're ready to bring back up the stack with just the single node in
  bootstrap mode.</p>
</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nv">STACK_NAME</span><span class="o">=</span>catalog-prod
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>sudo<span class="w"> </span>pc-deploy<span class="w"> </span><span class="nv">$STACK_NAME</span><span class="w"> </span>mariadb-cloud-force<span class="w"> </span>-v
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>docker<span class="w"> </span>service<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>-n10<span class="w"> </span><span class="nv">$STACK_NAME</span>-mariadb_galera
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Watch the logs until the state is happy and ready for connections (meaning
  that it will say "ready for connections" in the logs towards the end and
  stop printing messages). Then <em>bring the stack down again</em>, so it
  can be re-deployed with the regular cloud compose file. It is important
  to bring the stack down first so that it can cleanly stop first and disable
  its bootstrap state before the other nodes come online.</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nv">STACK_NAME</span><span class="o">=</span>catalog-prod
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>docker<span class="w"> </span>stack<span class="w"> </span>rm<span class="w"> </span><span class="nv">$STACK_NAME</span>-mariadb
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="c1"># wait for the container to stop, then re-deploy the original stack</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>sudo<span class="w"> </span>pc-deploy<span class="w"> </span><span class="nv">$STACK_NAME</span><span class="w"> </span>mariadb-cloud<span class="w"> </span>-v
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note on recovery time</p>
<p>It can take a few minutes to have each node come online, and it may appear as if
their volumes are empty during the recovery process. This is because the SST, or
state transfer, process is happening where it clears out the data and syncs it
from the leader node into a hidden <code>sst</code> directory until it completes. Depending on
the size of the database (particularly the sessions table) it can take a bit longer,
but typically less than 10 minutes. And it will only do this on one node at a time.
<strong>So be patient while waiting for the recovery!</strong> The service logs will indicate that
an SST is in progress and you will be able to run the <code>du</code> command on the volumes
to see them slowly growing.</p>
</div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>
<p>The stack should now come back up with all the nodes being healthy and
  joined to the cluster. You can use the steps from <a href="#verifying-cluster-health">verifying the cluster health</a>
  section below.</p>
</li>
<li>
<p>Open the <code>docker-compose.mariadb-cloud-force.yml</code> file again and restore it
  back to it's original state so it is ready to use for the next time.
  And so that someone doesn't accidentally deploy using that file without
  modifying it again.
  The file will be re-deployed automatically every time the pipeline is
  run, but this is in case that doesn't happen as frequently.</p>
</li>
<li>
<p>The final step is now to remove your leftover backup to save disk space.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nv">STACK_NAME</span><span class="o">=</span>catalog-prod
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/tmp/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>_mariadb_backup_<span class="k">$(</span>date<span class="w"> </span>-I<span class="k">)</span>/
</code></pre></div>
<h3 id="verifying-cluster-health">Verifying cluster health</h3>
<p>The quickest way to verify the status of the cluster is by viewing the
monitoring application at: https://[your stack URL]/monitoring.
Specifically look at the "Galera" status.</p>
<p>You can verify that all nodes are joined to the cluster via the Docker service
logs and scrolling up to look for the members list. There should be a list
similar to:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>members<span class="o">(</span><span class="m">3</span><span class="o">)</span>:
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="m">0</span>:<span class="w"> </span>1557dc68-6d5b-11ed-811e-5f59f6f49aa8,<span class="w"> </span>galera3
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="m">1</span>:<span class="w"> </span>15663de2-6d5b-11ed-b380-2abbd5ec6e2b,<span class="w"> </span>galera2
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="m">2</span>:<span class="w"> </span>f48d4f88-6d5a-11ed-978c-1b318d6b5649,<span class="w"> </span>galera1
</code></pre></div>
<p>You can also verify the cluster status by connecting to the database from
one of the nodes and querying for the WSREP status:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>SHOW<span class="w"> </span>GLOBAL<span class="w"> </span>STATUS<span class="w"> </span>LIKE<span class="w"> </span><span class="s1">&#39;%wsrep%&#39;</span><span class="se">\G</span>
</code></pre></div>
<p>some key values are the <code>wsrep_cluster_size</code> (which should match the number
of nodes you have) and the <code>wsrep_cluster_state_uuid</code> (which should be the
same on all the nodes).</p>
<p>Using the NCPA checks deployed via the catalog-infrastructure repository will
also run many of these health checks.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>sudo<span class="w"> </span>/usr/local/ncpa/plugins/check_galera.sh<span class="w"> </span>catalog-prod
</code></pre></div>
<h3 id="the-grastatedat-file">The <code>grastate.dat</code> File</h3>
<p>You really shouldn't ever <em>need</em> to go look at the <code>grastate.dat</code> file, but if you
do, it will quickly tell you the state of the node in the cluster. The file is located
at <code>/var/lib/docker/volumes/${STACK_NAME}-mariadb_db-bitnami/_data/mariadb/data/grastate.dat</code>.</p>
<p>If you look inside that file on any healthy running node in the cluster:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># GALERA saved state</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>version:<span class="w"> </span><span class="m">2</span>.1
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>uuid:<span class="w">    </span>2931f986-b407-11f0-b51e-777ecb991546
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>seqno:<span class="w">   </span>-1
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>safe_to_bootstrap:<span class="w"> </span><span class="m">0</span>
</code></pre></div>
<p>Or in a healthy stopped node in the cluster
(if the rest of the cluster is still up):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># GALERA saved state</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>version:<span class="w"> </span><span class="m">2</span>.1
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>uuid:<span class="w">    </span>2931f986-b407-11f0-b51e-777ecb991546
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>seqno:<span class="w">   </span><span class="m">9070</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>safe_to_bootstrap:<span class="w"> </span><span class="m">0</span>
</code></pre></div>
<p>Or when the cluster has shutdown cleanly (from the last shutdown node):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># GALERA saved state</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>version:<span class="w"> </span><span class="m">2</span>.1
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>uuid:<span class="w">    </span>2931f986-b407-11f0-b51e-777ecb991546
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>seqno:<span class="w">   </span><span class="m">9091</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>safe_to_bootstrap:<span class="w"> </span><span class="m">1</span>
</code></pre></div>
<p>When the cluster has shutdown cleanly (from the earlier shutdown node):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># GALERA saved state</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>version:<span class="w"> </span><span class="m">2</span>.1
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>uuid:<span class="w">    </span>2931f986-b407-11f0-b51e-777ecb991546
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>seqno:<span class="w">   </span><span class="m">9070</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>safe_to_bootstrap:<span class="w"> </span><span class="m">0</span>
</code></pre></div>
<p>Or on all the nodes when the cluster has stopped uncleanly (i.e. when they're
logging that no one is safe to bootstrap:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># GALERA saved state</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>version:<span class="w"> </span><span class="m">2</span>.1
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>uuid:<span class="w">    </span>2931f986-b407-11f0-b51e-777ecb991546
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>seqno:<span class="w">   </span>-1
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>safe_to_bootstrap:<span class="w"> </span><span class="m">0</span>
</code></pre></div>
<p>Comparing these, you can immediately notice some patterns:</p>
<ul>
<li>When the node has shutdown cleanly, it will have a <code>seqno</code> value of a
  positive number</li>
<li>The "leader" node, if shutdown cleanly, will have <code>safe_to_bootstrap</code>
  set to <code>1</code>. This means that if <em>none</em> of the nodes have a value of <code>1</code> if
  they are all shutdown, then the cluster was <em>not</em> shutdown cleanly.</li>
<li>None of the nodes should have <code>safe_to_bootstrap</code> set to <code>1</code> when the
  node is running, not even the "leader" node.</li>
<li>The <code>uuid</code> field is unique to each node in the cluster, and can be seen
  in the service logs when you see the member list printed.</li>
</ul>
<h2 id="how-to-break-the-cluster">How to break the cluster</h2>
<p>...for testing purposes only of course. In case you want to test-run the recovery
process, you can intentionally get your Galera cluster in an unhappy state by
force stopping all of the containers on all the nodes at the same time.</p>
<p>Log on to each of the nodes in your cluster and run the commands as close together
as possible:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nv">STACK_NAME</span><span class="o">=</span>devel-env
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>docker<span class="w"> </span><span class="nb">kill</span><span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="nv">$STACK_NAME</span>-mariadb_galera<span class="k">)</span>
</code></pre></div>
<p>You should be able to tell from the service logs that the cluster is unable to
recover on it's own now and needs your help!</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>docker<span class="w"> </span>service<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>-n100<span class="w"> </span><span class="nv">$STACK_NAME</span>-mariadb_galera
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="c1"># Look for:</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="c1"># No nodes online and I cannot bootstrap.</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="c1"># Another node must do the bootstrap.</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.expand", "navigation.instant"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../javascripts/tablesort.js"></script>
      
    
  </body>
</html>