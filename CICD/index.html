
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../harvesting-and-importing/">
      
      
        <link rel="next" href="../backup-and-restore/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>CI/CD - MSU Libraries Public Catalog Technical Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cicd" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MSU Libraries Public Catalog Technical Documentation" class="md-header__button md-logo" aria-label="MSU Libraries Public Catalog Technical Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MSU Libraries Public Catalog Technical Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CI/CD
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/MSU-Libraries/catalog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    MSU-Libraries/catalog
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MSU Libraries Public Catalog Technical Documentation" class="md-nav__button md-logo" aria-label="MSU Libraries Public Catalog Technical Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MSU Libraries Public Catalog Technical Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MSU-Libraries/catalog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    MSU-Libraries/catalog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tech-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technical Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../first-time-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    First Time Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../harvesting-and-importing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Harvesting &amp; Importing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    CI/CD
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    CI/CD
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#environment-based-on-branch-name" class="md-nav__link">
    <span class="md-ellipsis">
      Environment based on branch name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-stages-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Stages &amp; Jobs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    <span class="md-ellipsis">
      test
    </span>
  </a>
  
    <nav class="md-nav" aria-label="test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    <span class="md-ellipsis">
      Build
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      Clean-up
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#release" class="md-nav__link">
    <span class="md-ellipsis">
      Release
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scheduled-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduled Pipelines
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Administration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Administration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backup-and-restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backup &amp; Restore
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upgrading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrading
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vufind/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VuFind
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../solr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solr
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mariadb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MariaDB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../traefik/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Traefik
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring App
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../load-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Load Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helper-scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Helper Scripts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bots
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../job-schedules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Schedules
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Developing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Writing &amp; Running Tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-vufind/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Core VuFind Only
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alphabrowse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alphabrowse Internals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Processes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Processes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../communication-processes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Communication Processes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#environment-based-on-branch-name" class="md-nav__link">
    <span class="md-ellipsis">
      Environment based on branch name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-stages-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Stages &amp; Jobs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    <span class="md-ellipsis">
      test
    </span>
  </a>
  
    <nav class="md-nav" aria-label="test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    <span class="md-ellipsis">
      Build
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      Clean-up
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#release" class="md-nav__link">
    <span class="md-ellipsis">
      Release
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    <span class="md-ellipsis">
      Variables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scheduled-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduled Pipelines
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="cicd">CI/CD</h1>
<p>This page describes the GitLab CI/CD pipeline that is used by
the MSU Libraries team to deploy the Docker services as multiple stacks
in a multi-node Docker swarm cluster.</p>
<p>The <code>catalog-preview</code> branch represents the staging environment for
changes before they will be deployed to the production environments.</p>
<p>The <code>main</code> branch represents the stable production environment. Branches
with the prefix of <code>review-</code> or <code>devel-</code> will create separate stacks on
the cluster, auto-provisioning DNS CNAMES as part of the pipeline.</p>
<p>The workflow for developers will be to make code changes on <code>devel-</code>
environments, then merge them in to the <code>catalog-preview</code> branch,
and once a semester (approximately), we will merge that branch
into the <code>main</code> branch to deploy to production. Occasionally there
may be changes that need to go to production sooner, in that case they
will be merged to from the <code>devel-</code> branches to <em>BOTH</em> the <code>catalog-preview</code> and
the <code>main</code> branch.</p>
<h2 id="environment-based-on-branch-name">Environment based on branch name</h2>
<ul>
<li>
<p><strong>branch:</strong> <code>main</code>,<br />
<strong>stack prefix:</strong> <code>catalog-beta</code> (<code>catalog-beta-catalog</code>,
  <code>catalog-beta-solr</code>, <code>catalog-beta-mariadb</code>, etc.),<br />
<strong>URL:</strong> <a href="https://catalog-beta.lib.msu.edu">https://catalog-beta.lib.msu.edu</a>
  (local DNS C-Record to catalog.aws.lib.msu.edu)<br />
<strong>stack prefix:</strong> <code>catalog-prod</code> (<code>catalog-prod-catalog</code>,
  <code>catalog-prod-solr</code>, <code>catalog-prod-mariadb</code>, etc.),<br />
<strong>URL:</strong> <a href="https://catalog.lib.msu.edu">https://catalog.lib.msu.edu</a>
  (local DNS C-Record to catalog.aws.lib.msu.edu)</p>
</li>
<li>
<p><strong>branch:</strong> <code>catalog-preview</code>,<br />
<strong>stack prefix:</strong> <code>catalog-preview</code> (<code>catalog-preview-catalog</code>,
  <code>catalog-preview-solr</code>, <code>catalog-preview-mariadb</code>, etc.),<br />
<strong>URL:</strong> <a href="https://catalog-preview.lib.msu.edu">https://catalog-preview.lib.msu.edu</a>
  (local DNS C-Record to catalog.aws.lib.msu.edu)</p>
</li>
<li>
<p><strong>branch:</strong> <code>review-some-feature</code>,<br />
<strong>stack prefix:</strong> <code>review-some-feature</code> (<code>review-some-feature-catalog</code>,
  <code>review-some-feature-solr</code>, <code>review-some-feature-mariadb</code>, etc.),<br />
<strong>URL:</strong> <a href="https://review-some-feature.aws.lib.msu.edu">https://review-some-feature.aws.lib.msu.edu</a></p>
</li>
<li>
<p><strong>branch:</strong> <code>devel-some-feature</code>,<br />
<strong>stack prefix:</strong> <code>devel-some-feature</code> (<code>devel-some-feature-catalog</code>,
  <code>devel-some-feature-solr</code>, <code>devel-some-feature-mariadb</code>, etc.),<br />
<strong>URL:</strong> <a href="https://devel-some-feature.aws.lib.msu.edu">https://devel-some-feature.aws.lib.msu.edu</a></p>
</li>
<li>
<p><strong>branch:</strong> <code>nothing-special</code><br />
<strong>stack prefix:</strong> None, no environment created<br />
<strong>URL:</strong> None, no environment created</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>traefik</code> stack is shared by all of the stacks because it
controls routing public requests to the relavent stack based on
the host name.</p>
</div>
<p>The <code>devel</code> and <code>review</code> environments will have the following extra
characteristics:</p>
<ul>
<li>An extra job in the pipeline that can be manually run to clean up
  the environment when you are done with it</li>
<li>Only a subset of the harvest records will be imported</li>
</ul>
<h2 id="pipeline-stages-jobs">Pipeline Stages &amp; Jobs</h2>
<h2 id="test">test</h2>
<p><strong>branches</strong>: <code>main</code>, <code>catalog-preview</code>, <code>devel-</code>*, and <code>review-</code>*</p>
<ul>
<li>Runs templates included with GitLab CI/CD to scan for secrets used
  in committed code</li>
<li>Runs <code>shellcheck</code> on all bash scripts in the repository</li>
</ul>
<h3 id="build">Build</h3>
<p><strong>branches</strong>: <code>main</code>, <code>catalog-preview</code>, <code>devel-</code>*, and <code>review-</code>*</p>
<ul>
<li>Builds all the images in this repository, tagging them with <code>latest</code>
  only if it is the <code>main</code> branch</li>
<li>When building the VuFind image, it will also perform unit testing
  of the <code>Catalog</code> module</li>
</ul>
<h3 id="deploy">Deploy</h3>
<p><strong>branches</strong>: <code>main</code>, <code>catalog-preview</code>, <code>devel-</code>*, and <code>review-</code>*</p>
<ul>
<li>Will set the <code>STACK_NAME</code> variable that is used throughout the pipeline,
  which is essentially the branch name unless the branch does not start with
  <code>devel-</code>, <code>review-</code> or is <code>main</code></li>
<li>Will make updates to the docker compose files and copy them to the AWS
  servers. The updates include changing the image tag from <code>:latest</code> to
  the current commit SHA and modifying services based on the <code>STACK_NAME</code></li>
<li>Will call the playbook that creates a DNS record for devel and review
  environments if necessary</li>
<li>Deploy both the traefik (which handles routing of public traffic to the
  different environments hosted on the swarm) and the internal network used
  by the MariaDB Galera services within the individual environment</li>
<li>Will bootstrap the <code>solr</code> and <code>mariadb</code> stacks if they have not already
  been (i.e. this is the first time running this job for this branch)</li>
<li>Deploys the <code>catalog</code>, <code>solr</code>, <code>swarm-cleanup</code>, and <code>mariadb</code> stacks.
  If this is a devel or review environment, it will import a single MARC
  file into the VuFind instance as test data</li>
<li>Runs VuFind version upgrades, if applicable</li>
<li>If on a the <code>main</code> branch, it will run functional testing with the tests
  in the <code>Catalog</code> module</li>
<li>If it is a <code>devel-</code> or <code>review-</code> branch, it will populate the environment
  with sample data</li>
<li>Evaluate the health of the services on all nodes</li>
</ul>
<h3 id="clean-up">Clean-up</h3>
<p><strong>branches</strong>: <code>devel-</code>* and <code>review-</code>*</p>
<ul>
<li>Removes the stacks, their volumes, and runs the playbook to remove the DNS
  record created for the environment</li>
</ul>
<h3 id="release">Release</h3>
<p><strong>branches</strong>: <code>main</code></p>
<ul>
<li>Creates a release tag for the current commit</li>
<li>Pushes the latest changes to GitHub and publishes the GitHub Pages once
  the GitHub Action job should have completed that compiles the docs</li>
</ul>
<h2 id="variables">Variables</h2>
<p>At this time, the following variables need to be defined in the
project's CI/CD settings to be available to the pipeline. While it
is ok for variables to be marked as <code>masked</code>, they can not be marked
as <code>protected</code>; otherwise they will not be available in the <code>devel-</code>
and <code>review-</code> pipelines. You may need to define the same variable multiple
times, but for each environment, so that each site has different values.
For example, your development environments might have different values for
<code>FOLIO_URL</code> then the production environment. This is done using the <em>scope</em>
setting in the variables menu. And the <em>scope</em> value is the branch name you
want to match it to followed by a wildcard (<code>*</code>). For example: <code>devel-mytest*</code>.</p>
<ul>
<li><code>AUTH_FTP_PASSWORD</code>: Password for <code>AUTH_FTP_USER</code></li>
<li><code>AUTH_FTP_USER</code>: Username for the authority MARC file FTP server</li>
<li><code>AWS_KEY</code>: The AWS access key to use when provisioning the DNS CNAME records</li>
<li><code>AWS_SECRET</code>: The AWS secret for the <code>AWS_KEY</code> uses when provisioning
  the DNS CNAME records</li>
<li><code>BASICAUTH_FOR_RESOURCES</code>: Bcrypt password hash[^1] for basic authentication
  to internal resources such as Solr and the Traefik dashboard</li>
<li><code>BROWZINE_LIBRARY</code>: Library ID for BrowZine (LibKey)</li>
<li><code>BROWZINE_TOKEN</code>: BrowZine API token (LibKey)</li>
<li><code>DEPLOY_HOST_1</code>: Server FQDN for the for first node in the cluster to
  deploy to</li>
<li><code>DEPLOY_HOST_2</code>: Server FQDN for the for second node in the cluster to
  deploy to</li>
<li><code>DEPLOY_HOST_3</code>: Server FQDN for the for thirds node in the cluster to
  deploy to</li>
<li><code>DEPLOY_KEY_FILE</code>: File path containing GitLab read-only deploy key
  base64 encoded</li>
<li><code>DEPLOY_PRIVATE_KEY</code>: The <code>base64</code> encoded private SSH key to the
  deploy server</li>
<li><code>EDS_ORG</code>: Organization ID for the EDS API</li>
<li><code>EDS_PASS</code>: Password for the <code>EDS_USER</code> username</li>
<li><code>EDS_PROFILE</code>: Profile name for EDS</li>
<li><code>EDS_USER</code>: Username for the EDS API</li>
<li><code>EMAIL</code>: Email address set in VuFind's configs</li>
<li><code>FEEDBACK_EMAIL</code>: Email address for sending feedback form submissions to
  (internal and external)</li>
<li><code>FEEDBACK_PUBLIC_EMAIL</code>: Email address for sending external feedback form
  submissions to</li>
<li><code>FOLIO_CANCEL_ID</code>: The FOLIO cancellation ID to use when canceling an
  order. VuFind uses <code>75187e8d-e25a-47a7-89ad-23ba612338de</code> by default</li>
<li><code>FOLIO_PASS</code>: Password for the <code>FOLIO_USER</code> application user used by VuFind</li>
<li><code>FOLIO_REC_ID</code>: Record ID in FOLIO to search for to verify the tenant
  is available</li>
<li><code>FOLIO_TENANT</code>: Tenant ID</li>
<li><code>FOLIO_URL</code>: Okapi URL for FOLIO used by VuFind</li>
<li><code>FOLIO_USER</code>: Application user used by VuFind for ILS calls</li>
<li><code>HLM_FTP_PASSWORD_FILE</code>: File path containing the password for <code>HLM_FTP_USER</code></li>
<li><code>HLM_FTP_USER</code>: Username for the EBSCO FTP server</li>
<li><code>GITHUB_USER_TOKEN</code>: Token used to publish releases to GitHub repository</li>
<li><code>GOAWAY_JWT_PRIVATE_KEY_SEED</code>: Seed for captcha challenge verification; this
  should be set to a unique 64 char hex value, which allows captcha
  containers to validate challenges across replicas.</li>
<li><code>MATOMO_SEARCHBACKEND_DIMENSION</code>: ID for the custom dimension in Matomo to
  track the search backend used for the request</li>
<li><code>MATOMO_SITE_ID</code>: Matomo site identifier for the website you want the
  analytics sent to</li>
<li><code>MATOMO_URL</code>: Matomo URL to send the analytics to</li>
<li><code>OAI_URL</code>: URL for making OAI calls to FOLIO when harvesting (can include
  API Token)</li>
<li><code>RECAPTCHA_SECRET_KEY</code>: Secret key for reCaptcha form validation</li>
<li><code>RECAPTCHA_SITE_KEY</code>: Site key for reCaptcha form validation</li>
<li><code>REGISTRY_ACCESS_TOKEN</code>: Read-only registry access token used by deploy user</li>
<li><code>ROUND_ROBIN_DNS</code>: The DNS A-record entry that is a round-robin to all nodes
  in the cluster</li>
<li><code>RO_CICD_TOKEN</code>: Read-only access token to this repository used to query the
  API during the CI</li>
<li><code>RW_CICD_TOKEN</code>: Read-Write access token to this repository used to create
  release tags</li>
<li><code>SESSION_BOT_SALT</code>: Secure random string used in creating persisting session
  ids for bots (when bot_agent values are set)</li>
<li><code>SIMPLESAMLPHP_ADMIN_PW_FILE</code>: File path containing the password to the admin
  interface of SimpleSAMLphp</li>
<li><code>SIMPLESAMLPHP_SALT</code>: Random salt for SimpleSAMLphp</li>
<li><code>VUFIND_CORE_INSTALLATION</code>: Set to <code>1</code> in the pipelines to install core-vufind
  without MSUL Catalog module. Set to <code>0</code> otherwise.</li>
</ul>
<h2 id="scheduled-pipelines">Scheduled Pipelines</h2>
<p>For the Ansible image to build overnight, saving time on regular daily builds,
we can set up a scheduled pipeline to run off-hours in GitLab. This is done
in the <a href="https://gitlab.msu.edu/msu-libraries/catalog/catalog/-/pipeline_schedules">Schedules</a>
tab in the CI/CD page of GitLab. You should configure it for the <code>main</code> branch
and set it to run at whatever time is convenient for your team.</p>
<p>[^1]
    There are many ways to generate this password hash, such as online
    generators or command line tools (like <code>htpasswd</code> in the <code>apache-utils</code>
    package, for example: <code>htpasswd -B -C 10 -n [username]</code>).
    For Traefik performance reasons, we recommend you use a bcrypt cost
    value of 10.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.instant"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../javascripts/tablesort.js"></script>
      
    
  </body>
</html>