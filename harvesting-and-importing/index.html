
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../first-time-setup/">
      
      
        <link rel="next" href="../CICD/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Harvesting & Importing - MSU Libraries Public Catalog Technical Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#harvesting-importing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MSU Libraries Public Catalog Technical Documentation" class="md-header__button md-logo" aria-label="MSU Libraries Public Catalog Technical Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MSU Libraries Public Catalog Technical Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Harvesting &amp; Importing
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/MSU-Libraries/catalog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    MSU-Libraries/catalog
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MSU Libraries Public Catalog Technical Documentation" class="md-nav__button md-logo" aria-label="MSU Libraries Public Catalog Technical Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MSU Libraries Public Catalog Technical Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MSU-Libraries/catalog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    MSU-Libraries/catalog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tech-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technical Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../first-time-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    First Time Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Harvesting &amp; Importing
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Harvesting &amp; Importing
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#script-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Script Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlm-data" class="md-nav__link">
    <span class="md-ellipsis">
      HLM Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-data-harvests" class="md-nav__link">
    <span class="md-ellipsis">
      Full Data Harvests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Full Data Harvests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#folio" class="md-nav__link">
    <span class="md-ellipsis">
      FOLIO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlm" class="md-nav__link">
    <span class="md-ellipsis">
      HLM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backstage-authority-records" class="md-nav__link">
    <span class="md-ellipsis">
      Backstage (Authority records)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-data-imports" class="md-nav__link">
    <span class="md-ellipsis">
      Full Data Imports
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Full Data Imports">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#biblio-index" class="md-nav__link">
    <span class="md-ellipsis">
      biblio Index
    </span>
  </a>
  
    <nav class="md-nav" aria-label="biblio Index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#importing-folio-records-using-the-cron-container" class="md-nav__link">
    <span class="md-ellipsis">
      Importing FOLIO records using the cron container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-folio-records-in-dev-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Importing FOLIO records in dev environments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-hlm-records-using-the-cron-container" class="md-nav__link">
    <span class="md-ellipsis">
      Importing HLM records using the cron container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use-the-collection-aliases-to-rebuild-and-swap" class="md-nav__link">
    <span class="md-ellipsis">
      How to Use the Collection Aliases to Rebuild and Swap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authority-index" class="md-nav__link">
    <span class="md-ellipsis">
      authority Index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reserves-index" class="md-nav__link">
    <span class="md-ellipsis">
      reserves Index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-generated-call-numbers" class="md-nav__link">
    <span class="md-ellipsis">
      Adding generated call numbers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ignoring-certain-hlm-files" class="md-nav__link">
    <span class="md-ellipsis">
      Ignoring certain HLM files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-vufind-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Using VuFind Utilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using VuFind Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#harvesting-from-folio" class="md-nav__link">
    <span class="md-ellipsis">
      Harvesting from Folio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-into-vufind" class="md-nav__link">
    <span class="md-ellipsis">
      Importing into VuFind
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CICD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CI/CD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Administration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Administration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backup-and-restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backup &amp; Restore
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upgrading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrading
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vufind/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VuFind
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../solr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solr
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mariadb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MariaDB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../traefik/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Traefik
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring App
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../load-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Load Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helper-scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Helper Scripts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bots
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../job-schedules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Job Schedules
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Developing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Writing &amp; Running Tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-vufind/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Core VuFind Only
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alphabrowse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Alphabrowse Internals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Processes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Processes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../communication-processes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Communication Processes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#script-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Script Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hlm-data" class="md-nav__link">
    <span class="md-ellipsis">
      HLM Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-data-harvests" class="md-nav__link">
    <span class="md-ellipsis">
      Full Data Harvests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Full Data Harvests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#folio" class="md-nav__link">
    <span class="md-ellipsis">
      FOLIO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hlm" class="md-nav__link">
    <span class="md-ellipsis">
      HLM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backstage-authority-records" class="md-nav__link">
    <span class="md-ellipsis">
      Backstage (Authority records)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-data-imports" class="md-nav__link">
    <span class="md-ellipsis">
      Full Data Imports
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Full Data Imports">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#biblio-index" class="md-nav__link">
    <span class="md-ellipsis">
      biblio Index
    </span>
  </a>
  
    <nav class="md-nav" aria-label="biblio Index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#importing-folio-records-using-the-cron-container" class="md-nav__link">
    <span class="md-ellipsis">
      Importing FOLIO records using the cron container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-folio-records-in-dev-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Importing FOLIO records in dev environments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-hlm-records-using-the-cron-container" class="md-nav__link">
    <span class="md-ellipsis">
      Importing HLM records using the cron container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-use-the-collection-aliases-to-rebuild-and-swap" class="md-nav__link">
    <span class="md-ellipsis">
      How to Use the Collection Aliases to Rebuild and Swap
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authority-index" class="md-nav__link">
    <span class="md-ellipsis">
      authority Index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reserves-index" class="md-nav__link">
    <span class="md-ellipsis">
      reserves Index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-generated-call-numbers" class="md-nav__link">
    <span class="md-ellipsis">
      Adding generated call numbers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ignoring-certain-hlm-files" class="md-nav__link">
    <span class="md-ellipsis">
      Ignoring certain HLM files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-vufind-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Using VuFind Utilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using VuFind Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#harvesting-from-folio" class="md-nav__link">
    <span class="md-ellipsis">
      Harvesting from Folio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importing-into-vufind" class="md-nav__link">
    <span class="md-ellipsis">
      Importing into VuFind
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="harvesting-importing">Harvesting &amp; Importing</h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All of these commands should be run within the <code>catalog</code> or <code>cron</code>
Docker container</p>
</div>
<h2 id="script-summary">Script Summary</h2>
<ul>
<li><a href="https://github.com/MSU-Libraries/catalog/blob/main/vufind/scripts/pc-import-folio">pc-import-folio</a>:
  Used to harvest and import FOLIO MARC data into the <code>biblio</code> collection
  of Solr.</li>
<li><a href="https://github.com/MSU-Libraries/catalog/blob/main/vufind/scripts/pc-import-hlm">pc-import-hlm</a>:
  Used to harvest and import EBSCO MARC data into the <code>biblio</code> collection
  of Solr from the FTP location given access to by EBSCO. The records
  contain the HLM dataset that is missing from FOLIO's database.</li>
<li><a href="https://github.com/MSU-Libraries/catalog/blob/main/vufind/scripts/pc-import-authority">pc-import-authority</a>:
  Used to harvest and import MARC data from Backstage into the <code>authority</code>
  collection in Solr from the FTP location provided by Backstage.</li>
<li><a href="https://github.com/MSU-Libraries/catalog/blob/main/vufind/scripts/cron-reserves.sh">cron-reserves.sh</a>:</li>
<li><a href="https://gitlab.msu.edu/msu-libraries/catalog/catalog-infrastructure/-/blob/main/configure-playbook/roles/deploy-helper-scripts/files/pc-full-import?ref_type=heads">pc-full-import</a>:
  Wrapper script for the <code>pc-import-folio</code> and <code>pc-import-hlm</code> scripts to
  perform a full import of data.</li>
</ul>
<h2 id="hlm-data">HLM Data</h2>
<p>One of our sources is HLM (Holdings Link Management) which is files from
EBSCO's FTP server with electronic resources our library has access to
which are not in FOLIO. To automate the retrieval and import of these
files we have a wrapper script, <code>pc-import-hlm</code>.</p>
<p>Since occasionally EBSCO sends us full sets of data, we want to be able
to exclude all previous sets from them, so to do this we have an ignore
files <code>/mnt/shared/oai/ignore_patterns.txt</code> with will check to see if the file
name contains any of those substrings and ignore them if they match.</p>
<p>Also, we will only harvest files that match the pattern <code>*.m*c</code> and <code>*.zip</code>.
<code>*.m*c</code> files will be imported with the exception of <code>-del*.m*c</code> (case
insensitive) or <code>.delete</code> files which will instead be tagged as deletion files.</p>
<p>If you simply want to see what files are on the FTP server currently, you can
run our helper script, <code>pc-list-hlm-remote</code>, to list all the files. If you
want to download a specific file, run <code>pc-get-hlm-remote [NAME OF FILE]</code>.</p>
<h2 id="full-data-harvests">Full Data Harvests</h2>
<p>This section describes the steps needed to re-harvest all the data from
each source.</p>
<h3 id="folio">FOLIO</h3>
<!-- markdownlint-disable MD031 -->
<ol>
<li>
<p>Ensure that your OAI settings on the FOLIO tenant are what you want
   them to be for this particular harvest. For example, if you wish to
   include storage and inventory records (i.e. the records without a
   MARC source) then you will need to modify the "Record Source" field
   in the OAI Settings in FOLIO.</p>
</li>
<li>
<p>Next you will need to clear out the contents of the <code>harvest_folio</code>
   directory before the next cron job will run. Assuming you want to
   preserve the last harvest for the time being, you can simply move
   those directories somewhere else and rename them. Below is an example,
   but certainly not the only option. The only goal is that the
   <code>harvest_folio</code> directory has no files in it, but can have the <code>log</code>
   and <code>processed</code> directories within it as long as they are empty
   (they technically can have files in them, you just will not want
   them to have files since they will get mixed in with your new harvest).
   <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">cd</span><span class="w"> </span>/mnt/shared/oai/<span class="o">[</span>STACK_NAME<span class="o">]</span>/harvest_folio/
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>mv<span class="w"> </span>processed<span class="w"> </span>processed_old
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>mv<span class="w"> </span>log<span class="w"> </span>log_old
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>mv<span class="w"> </span>last_state.txt<span class="w"> </span>last_state.txt.old
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>mv<span class="w"> </span>harvest.log<span class="w"> </span>harvest.log.old
</code></pre></div></p>
</li>
<li>
<p>Monitor progress after it starts via the cron job in the monitoring app
   or in the log file on the container or volume (<code>/mnt/logs/harvests/</code>).</p>
</li>
</ol>
<!-- markdownlint-enable MD031 -->

<h3 id="hlm">HLM</h3>
<p>This can just be done with the script's <code>--full</code> <code>--harvest</code> flags in a
one-off run, but if you prefer to have it run via the cron job use it's
normal flags, here are the steps you would need to do in order to prepare
the environment.</p>
<!-- markdownlint-disable MD013 MD031 -->
<ol>
<li>
<p>Remove all files from the <code>/mnt/shared/hlm/[STACK_NAME]/harvest_hlm/</code>
   directory. You can also just move them somewhere else if you want to preserve a copy of them.
   <div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nb">cd</span><span class="w"> </span>/mnt/shared/hlm/<span class="o">[</span>STACK_NAME<span class="o">]</span>/harvest_hlm/
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>mv<span class="w"> </span>processed<span class="w"> </span>processed_old
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>mv<span class="w"> </span>log<span class="w"> </span>log_old
</code></pre></div></p>
</li>
<li>
<p>Monitor progress after it starts via the cron job in the monitoring app or
   in the log file on the container or volume (<code>/mnt/logs/harvests/</code>).</p>
</li>
</ol>
<!-- markdownlint-enable MD013 MD031 -->

<h3 id="backstage-authority-records">Backstage (Authority records)</h3>
<p>This can just be done with the script's <code>--full</code> <code>--harvest</code> flags in a
one-off run, but if you prefer to have it run via the cron job use it's normal
flags, here are the steps you would need to do in order to prepare
the environment.</p>
<!-- markdownlint-disable MD031 -->
<ol>
<li>
<p>Remove all files from the <code>/mnt/shared/authority/$STACK_NAME/harvest_authority/</code>
   directory.
   You can also just move them somewhere else if you want to preserve a copy
   of them.
   <div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>tar<span class="w"> </span>-czf<span class="w"> </span>archive_<span class="o">[</span>SOME_DATE<span class="o">]</span>.tar.gz<span class="w"> </span>/mnt/shared/authority/<span class="nv">$STACK_NAME</span>/harvest_authority/
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>find<span class="w"> </span>/mnt/shared/authority/<span class="nv">$STACK_NAME</span>/harvest_authority/<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-delete
</code></pre></div></p>
</li>
<li>
<p>Monitor progress after it starts via the cron job in the monitoring app or
in the log file on the container or volume (<code>/mnt/logs/harvests/</code>).</p>
</li>
</ol>
<!-- markdownlint-enable MD031 -->

<h2 id="full-data-imports">Full Data Imports</h2>
<h3 id="biblio-index"><code>biblio</code> Index</h3>
<!-- markdownlint-disable MD013 MD046 -->
<div class="admonition tip">
<p class="admonition-title">Helper script for full import</p>
<p>There is now a helper script to run <em>all</em> of the below steps in the proper
order to do a full re-import of data in the <code>biblio</code> index. See the full
documentation for the <a href="../helper-scripts/#run-full-import-pc-full-import">pc-full-import</a>
and the below for a simple example.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>sudo<span class="w"> </span>screen
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="c1"># Prompting for confirmation</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>pc-full-import<span class="w"> </span>catalog-prod<span class="w"> </span>--debug<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/mnt/shared/logs/catalog-prod-import_<span class="k">$(</span>date<span class="w"> </span>-I<span class="k">)</span>.log
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1"># Bypassing user confirmation and notifying pubcat on completion</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>pc-full-import<span class="w"> </span>catalog-prod<span class="w"> </span>--email<span class="w"> </span>LIB.DL.pubcat@msu.edu<span class="w"> </span>--yes<span class="w"> </span>--debug<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/mnt/shared/logs/catalog-prod-import_<span class="k">$(</span>date<span class="w"> </span>-I<span class="k">)</span>.log
</code></pre></div>
<p>Should you choose to do the steps manually, this section will describe
the process needed to run a full re-import of the data since that is
frequently required to update the Solr index with new field updates.
If other tasks are required (such as full harvests or incremental) refer
to the <code>--help</code> flags on the appropriate script.</p>
</div>
<!-- markdownlint-enable MD013 MD046 -->

<p>Full imports for the <code>biblio</code> collection can be done</p>
<ul>
<li>directly in the <code>cron</code> container for prod/beta/preview,</li>
<li>in the <code>catalog</code> container for dev environments,</li>
<li>using the <code>biblio</code> collection alias in the <code>build</code> container,
to avoid serving incomplete collections in prod (see
<a href="#how-to-use-the-collection-aliases-to-rebuild-and-swap">How to Use the Collection Aliases to Rebuild and Swap</a>
below).</li>
</ul>
<h4 id="importing-folio-records-using-the-cron-container">Importing FOLIO records using the cron container</h4>
<p>Connect to one of the catalog server nodes and move the following files up
a level out of the processed directory in the shared storage. This will allow
them to be picked up by the next cron job and re-started automatically should
the container get stopped due to deployments. Progress can be monitored
by checking then number of files remaining in the directory and the log file
in <code>/mnt/logs/harvests/folio_latest.log</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Can be done inside or outside the container</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>mv<span class="w"> </span>/mnt/shared/oai/<span class="o">[</span>STACK_NAME<span class="o">]</span>/harvest_folio/processed/*<span class="w"> </span>/mnt/shared/oai/<span class="o">[</span>STACK_NAME<span class="o">]</span>/harvest_folio/
</code></pre></div>
<h4 id="importing-folio-records-in-dev-environments">Importing FOLIO records in dev environments</h4>
<p>This will import the tests records. In the <code>catalog</code> container:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>./pc-import-folio<span class="w"> </span>-c<span class="w"> </span>/mnt/shared/oai/devel-batch<span class="w"> </span>-l<span class="w"> </span><span class="m">1</span><span class="w"> </span>-b<span class="w"> </span>-v<span class="w"> </span>-r
</code></pre></div>
<h4 id="importing-hlm-records-using-the-cron-container">Importing HLM records using the cron container</h4>
<p>Assuming HLM records also need to be updated in the <code>biblio</code> index as
well, you will need to copy those files from the shared directory into
the container prior to starting the script. Then start a <code>screen</code> session
and connect to the container again and run the command to import the files.
Note that this will get terminated and not be recoverable if the container
stops due to a deploy like the previous command was. Process can be monitored
by seeing the remaining files in the <code>/usr/local/harvest/hlm/</code> directory
and by re-attaching to the <code>screen</code> (by using <code>screen -r</code>) to see if the command
has completed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># Done inside the catalog_cron container</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>cp<span class="w"> </span>/mnt/shared/hlm/<span class="o">[</span>STACK_NAME<span class="o">]</span>/current/*<span class="w"> </span>/usr/local/vufind/local/harvest/hlm/
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1"># You will want to kick off this command in a screen session,</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c1"># since it can take many hours to run</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>/usr/local/bin/pc-import-hlm<span class="w"> </span>-i<span class="w"> </span>-v
</code></pre></div>
<h4 id="how-to-use-the-collection-aliases-to-rebuild-and-swap">How to Use the Collection Aliases to Rebuild and Swap</h4>
<p>As mentioned in the <a href="../solr/#collection-structure">Solr documentation</a>, <code>biblio</code>
uses aliases to manage directing VuFind to the collection in Solr that have the
"live" biblio data that should be used for searching: <code>biblio1</code> or <code>biblio2</code>.
This means we will on occasion need to swap them. This occasion being when
we rebuild the index, such as when we're adding new data fields or doing a
VuFind version upgrade (...which typically add new data fields).</p>
<ul>
<li>
<p>Start the manual task "Deploy VuFind Build Env" in GitLab. It will update
  the <code>catalog_build</code> container. This is not done automatically so that other
  updates to the main branch can be deployed while a full import is running.</p>
</li>
<li>
<p>Identify what collection each alias is pointing to currently
  (i.e. is <code>biblio</code> pointing to <code>biblio1</code> or <code>biblio2</code>) and confirm
  the <strong>other</strong> collection is what <code>biblio-build</code> is pointing to.
  To get the list of aliases, from a container:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>curl<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;http://solr:8983/solr/admin/collections?action=LISTALIASES&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>biblio
</code></pre></div>
<ul>
<li>Rebuild the index on <code>biblio-build</code> using the <code>catalog_build</code> container.
  This has everything that the <code>catalog_cron</code> containers have access to, but
  do not run <code>cron</code> jobs since rebuilds do not happen at regular or frequent
  intervals. In fact, all this container does is sleep! It is recommended to
  run these commands in a <code>screen</code>.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you run a deploy pipeline while this is running, you will not want to
run the manual job that deploys the updates to the build container (since
not all the import scripts are configured to resume where they left off
yet).</p>
</div>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># On Host</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>screen
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span><span class="nv">name</span><span class="o">=</span>catalog-prod-catalog_build<span class="k">)</span><span class="w"> </span>bash
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1"># Inside container</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>rm<span class="w"> </span>local/harvest/folio/processed/*
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>cp<span class="w"> </span>/mnt/shared/oai/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/harvest_folio/processed/*<span class="w"> </span>local/harvest/folio/
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>/usr/local/bin/pc-import-folio<span class="w"> </span>--verbose<span class="w"> </span>--reset-solr<span class="w"> </span>--collection<span class="w"> </span>biblio-build<span class="w"> </span>--batch-import<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/mnt/shared/logs/folio_import_<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>_<span class="k">$(</span>date<span class="w"> </span>-I<span class="k">)</span>.log
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="o">[</span>Ctrl-a<span class="w"> </span>d<span class="o">]</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="c1"># On Host</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>screen
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span><span class="nv">name</span><span class="o">=</span>catalog-prod-catalog_build<span class="k">)</span><span class="w"> </span>bash
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="c1"># Inside container</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>cp<span class="w"> </span>/mnt/shared/hlm/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/current/*<span class="w"> </span>local/harvest/hlm/
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>/usr/local/bin/pc-import-hlm<span class="w"> </span>--import<span class="w"> </span>--verbose<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/mnt/shared/logs/hlm_import_<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>_<span class="k">$(</span>date<span class="w"> </span>-I<span class="k">)</span>.log
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="o">[</span>Ctrl-a<span class="w"> </span>d<span class="o">]</span>
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Verify the counts are what you expect on the <code>biblio-build</code> collection
  using the following command</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr:8983/solr/admin/metrics?nodes=solr1:8983_solr,solr2:8983_solr,solr3:8983_solr&amp;prefix=SEARCHER.searcher.numDocs,SEARCHER.searcher.deletedDocs&amp;wt=json&#39;</span>
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Build the spellchecking indices</li>
</ul>
<p>Building these indices is only necessary for a full import.</p>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr1:8983/solr/biblio-build/select?q=*:*&amp;spellcheck=true&amp;spellcheck.build=true&#39;</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr2:8983/solr/biblio-build/select?q=*:*&amp;spellcheck=true&amp;spellcheck.build=true&#39;</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr3:8983/solr/biblio-build/select?q=*:*&amp;spellcheck.true&amp;spellcheck.build=true&#39;</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="nb">wait</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr1:8983/solr/biblio-build/select?q=*:*&amp;spellcheck.dictionary=basicSpell&amp;spellcheck=true&amp;spellcheck.build=true&#39;</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr2:8983/solr/biblio-build/select?q=*:*&amp;spellcheck.dictionary=basicSpell&amp;spellcheck=true&amp;spellcheck.build=true&#39;</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr3:8983/solr/biblio-build/select?q=*:*&amp;spellcheck.dictionary=basicSpell&amp;spellcheck=true&amp;spellcheck.build=true&#39;</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="nb">wait</span>
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<p><code>/bitnami/solr/server/solr/biblioN/spellShingle</code> and
<code>/bitnami/solr/server/solr/biblioN/spellchecker</code> should have a significant
size afterward in the solr container (replace <code>biblioN</code> by the
<code>biblio-build</code> collection)</p>
<ul>
<li>Your Solr instance will likely require more memory than it typically needs
  to do the collection alias swap. Be sure to increase and deploy the stack
  with additional <code>SOLR_JAVA_MEM</code> as required to  ensure no downtime during
  this step. Currently, 6G (which we use in prod) is enough for the swap.
  Alternatively (for beta and preview), let it crash after these commands
  and restart the pipeline to help Solr cloud fix itself.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># Open the solr-cloud compose file for your environment</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>vim<span class="w"> </span>docker-compose.solr-cloud.yml
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c1"># Modify the memory line to:</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>SOLR_JAVA_MEM:<span class="w"> </span>-Xms8192m<span class="w"> </span>-Xmx8192m
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="c1"># Now on the host, run the deploy helper script</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>sudo<span class="w"> </span>pc-deploy<span class="w"> </span><span class="o">[</span>ENV_NAME<span class="o">]</span><span class="w"> </span>solr-cloud
</code></pre></div>
<ul>
<li>Once you are confident in the new data, you are ready to do the swap!
  <strong>BE SURE TO SWAP THE NAME AND COLLECTION IN THE BELOW COMMAND EXAMPLE</strong></li>
</ul>
<!-- markdownlint-disable MD046 -->
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># Command to check the aliases (repeated from above)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>curl<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;http://solr:8983/solr/admin/collections?action=LISTALIASES&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>biblio
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># This EXAMPLE sets biblio-build to biblio2, and biblio to biblio1</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="c1"># biblio-build =&gt; biblio2</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="c1"># biblio       =&gt; biblio1</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr:8983/solr/admin/collections?action=CREATEALIAS&amp;name=biblio-build&amp;collections=biblio2&#39;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr:8983/solr/admin/collections?action=CREATEALIAS&amp;name=biblio&amp;collections=biblio1&#39;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># This EXAMPLE sets biblio-build to biblio1, and biblio to biblio2</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="c1"># biblio-build =&gt; biblio1</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c1"># biblio       =&gt; biblio2</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr:8983/solr/admin/collections?action=CREATEALIAS&amp;name=biblio-build&amp;collections=biblio1&#39;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr:8983/solr/admin/collections?action=CREATEALIAS&amp;name=biblio&amp;collections=biblio2&#39;</span>
</code></pre></div>
</div>
<!-- markdownlint-enable MD046 -->

<ul>
<li>
<p>If needed, back-date the timestamp on your <code>last_harvest.txt</code> re-harvest
  some of the OAI changes since you started the import</p>
</li>
<li>
<p>Clear out the collection that <code>biblio-build</code> is pointing to, to avoid
  having two large indexing stored for a long period of time (only
  after you are confident in the new index's data)</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>/usr/local/bin/pc-import-folio<span class="w"> </span>--verbose<span class="w"> </span>--reset-solr<span class="w"> </span>--collection<span class="w"> </span>biblio-build
</code></pre></div>
<ul>
<li>
<p>If <code>SOLR_JAVA_MEM</code> was increased, lower it to its previous amount.</p>
</li>
<li>
<p>Kick off a manual alpha browse re-index if you don't want it to be outdated
  until the next scheduled run.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># Run this on all of the host&#39;s</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-solr_cron<span class="k">)</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span>/alpha-browse.sh<span class="w"> </span>-v<span class="w"> </span>-f
</code></pre></div>
<h3 id="authority-index"><code>authority</code> Index</h3>
<p>Similar to the process for HLM records, copy the files from the shared
directory into the containers import location prior to starting the script.
Then start a <code>screen</code> session and connect to the container again and run
the command to import the files.
Process can be monitored by seeing the remaining files in the
<code>/usr/local/harvest/authority</code> directory and by re-attaching to the
<code>screen</code> (by using <code>screen -r</code>) to see if the command has completed.</p>
<!-- markdownlint-disable MD013 MD031 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>mv<span class="w"> </span>/mnt/shared/authority/<span class="nv">$STACK_NAME</span>/harvest_authority/processed/*.<span class="o">[</span><span class="m">0</span>-9<span class="o">][</span><span class="m">0</span>-9<span class="o">][</span><span class="m">0</span>-9<span class="o">]</span>.xml<span class="w"> </span>/mnt/shared/authority/<span class="nv">$STACK_NAME</span>/harvest_authority
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1"># You can either run the command manually in a screen, or let the cron pick it up</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>/usr/local/bin/pc-import-authority<span class="w"> </span>-i<span class="w"> </span>-B
</code></pre></div>
<!-- markdownlint-enable MD013 MD031 -->

<h3 id="reserves-index"><code>reserves</code> Index</h3>
<p>The course reserves data is refreshed by a Cron job on a nightly basis,
so likely you will not need to run this manually if you can just wait for the
regular run. But if needed, here is the command to run it off-schedule.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Done inside the container (ideally within a screen since it will</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="c1"># take hours to run)</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>php<span class="w"> </span>/usr/local/vufind/util/index_reserves.php
</code></pre></div>
<p>Alternatively, you can also modify the cron entry (or add a temporary
additional cron entry) in the cron container for the <code>cron-reserves.sh</code>
command to run at an earlier time. The benefit of this would be it would
save logs to <code>/mnt/logs/vufind/reserves_latest.log</code> and track them in the
Monitoring site.</p>
<h3 id="adding-generated-call-numbers">Adding generated call numbers</h3>
<p>This should be done after each full import (FOLIO + HLM) when data was reset,
in the <code>solr_solr</code> container:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>python3<span class="w"> </span>./add_generated_call_numbers.py
</code></pre></div>
<p>Partial call numbers are added to <code>callnumber-label</code> for records that didn't
have any when the <code>call_numbers.csv</code> file was generated.</p>
<p>Note that the call numbers in <code>/mnt/shared/call-numbers/call_numbers.csv</code> are
meant for beta/preview/prod. There is another file at
<code>/mnt/shared/call-numbers/test_call_numbers.csv</code> that can be used for testing
in dev.</p>
<h2 id="ignoring-certain-hlm-files">Ignoring certain HLM files</h2>
<p>If your EBSCO FTP server is set up in a way where it contains all of the sets
ever generated for you, then you'll likely want a way to have the <code>pc-import-hlm</code>
script ignore the past sets assuming you get new full sets periodically. This can
be done by adding a new substring pattern to ignore to the top level of the <code>hlm</code>
directory in the shared storage (<code>/mnt/shared/hlm/ignore_patterns.txt</code>). This
file is used automatically and created on the cron containers startup if it
doesn't exist. You can override the file path by using the <code>-p|--ignore-file</code>
flag.</p>
<h2 id="using-vufind-utilities">Using VuFind Utilities</h2>
<p>The preferred method is to use the included wrapper script with this repository.
The <a href="https://github.com/MSU-Libraries/catalog/blob/main/vufind/scripts/pc-import-folio">pc-import-folio</a>
script can run either, or both, the harvest and import of data from FOLIO to
VuFind. Use the <code>--help</code> flag to get information on how to run that script.</p>
<p>But should you choose to run the commands included directly with VuFind, below
is documentation on how to do that.</p>
<h3 id="harvesting-from-folio">Harvesting from Folio</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nb">cd</span><span class="w"> </span>/usr/local/vufind/harvest
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>php<span class="w"> </span>harvest_oai.php
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="c1">## This step is optional, it will combine the xml files into a single file</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="c1">## to improve the speed of the next import step.</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>find<span class="w"> </span>*.xml<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>xml_grep<span class="w"> </span>--wrap<span class="w"> </span>collection<span class="w"> </span>--cond<span class="w"> </span><span class="s2">&quot;marc:record&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>combined.xml
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>mkdir<span class="w"> </span>unmerged
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>mv<span class="w"> </span>*oai*.xml<span class="w"> </span>unmerged/
</code></pre></div>
<h3 id="importing-into-vufind">Importing into VuFind</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nb">cd</span><span class="w"> </span>/usr/local/vufind/harvest
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>./batch-import-marc.sh<span class="w"> </span>folio
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.instant"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../javascripts/tablesort.js"></script>
      
    
  </body>
</html>