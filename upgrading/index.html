
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../backup-and-restore/">
      
      
        <link rel="next" href="../vufind/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Upgrading - MSU Libraries Public Catalog Technical Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#upgrading" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MSU Libraries Public Catalog Technical Documentation" class="md-header__button md-logo" aria-label="MSU Libraries Public Catalog Technical Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MSU Libraries Public Catalog Technical Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Upgrading
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/MSU-Libraries/catalog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    MSU-Libraries/catalog
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MSU Libraries Public Catalog Technical Documentation" class="md-nav__button md-logo" aria-label="MSU Libraries Public Catalog Technical Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MSU Libraries Public Catalog Technical Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MSU-Libraries/catalog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    MSU-Libraries/catalog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tech-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Technical Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../first-time-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    First Time Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../harvesting-and-importing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Harvesting &amp; Importing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CICD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CI/CD
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Administration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Administration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../general/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    General
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backup-and-restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backup &amp; Restore
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Upgrading
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Upgrading
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vufind" class="md-nav__link">
    <span class="md-ellipsis">
      
        VuFind
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VuFind">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solr-config-schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solr Config &amp; Schema
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vufind/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VuFind
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../solr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Solr
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mariadb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MariaDB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../traefik/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Traefik
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring App
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../load-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Load Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helper-scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Helper Scripts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bots
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../job-schedules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Job Schedules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Developing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Developing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Writing &amp; Running Tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core-vufind/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using Core VuFind Only
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alphabrowse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alphabrowse Internals
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Processes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Processes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../communication-processes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Communication Processes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vufind" class="md-nav__link">
    <span class="md-ellipsis">
      
        VuFind
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VuFind">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solr-config-schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solr Config &amp; Schema
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="upgrading">Upgrading</h1>
<h2 id="vufind">VuFind</h2>
<p>For general documentation on how to upgrade VuFind, see the
<a href="https://vufind.org/wiki/installation:migration_notes#vufind_migration_notes">official documentation</a>.
This documentation will focus on how to upgrade specific to
this environment setup.</p>
<ul>
<li>
<p>Clone the <a href="https://github.com/vufind-org/vufind">VuFind repository</a>
  locally as well as <a href="https://github.com/MSU-Libraries/catalog">this repository</a>
  and check out the VuFind repository to the release tag that your environment
  is currently on.</p>
</li>
<li>
<p>Run the <a href="https://github.com/MSU-Libraries/catalog/blob/main/vufind/upgrade-helper.sh">upgrade-helper.sh</a>
  script to determine what config files in the local directory need to be
  updated with changes made to core files and apply them manually to
  <a href="https://github.com/MSU-Libraries/catalog">the catalog repository</a>
  in the <code>/vufind/local</code> directory. An example of running the command might be:
  <code>~/catalog/vufind/upgrade-helper.sh --target-release v10.1.1
  --current-release v10.0.1 --core-vf-path ~/vufind --msul-vf-path
  ~/catalog/vufind -v</code>.</p>
</li>
<li>
<p>Update the <a href="https://github.com/MSU-Libraries/catalog/blob/main/.gitlab-ci.yml">CI/CD Config</a>
  to update the <code>VUFIND_VERSION</code> variable to be the new release you
  are updating to.</p>
</li>
<li>
<p>If updating SimpleSAMLphp, also update <code>SIMPLESAMLPHP_VERSION</code> in the
  same file.</p>
</li>
<li>
<p>Create a new branch with these changes named either <code>review-</code>* or <code>devel-</code>*
  to trigger a pipeline with a new environment.</p>
</li>
<li>
<p>Make sure the <code>--data</code> parameters contains the right field in
  <code>solr_cache_warmup</code> in <code>pc-import-folio</code></p>
</li>
<li>
<p>Once the pipeline completes successfully, verify that the site loads
  and works correctly.</p>
</li>
<li>
<p>In order to test that a database migration will work correctly, take
  a fresh database dump of an environment at the older version and load
  it into the new release environment. Now connect to the catalog
  container on your development environment and run:</p>
</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>php<span class="w"> </span>public/index.php<span class="w"> </span>upgrade/database<span class="w"> </span>--interactive<span class="w"> </span>-vvv
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>
<p>Once thorough testing is complete, take a backup of the database on
  <code>main</code>, merge the branch into <code>main</code>, then repeat the database migration
  steps once the pipeline completes.</p>
</li>
<li>
<p>It is recommended to do a re-index of Solr to apply the latest schema
  changes, if the helper script detected any. In order to do this, you will
  need to run the <a href="https://github.com/MSU-Libraries/catalog/blob/main/vufind/scripts/pc-import-folio">pc-import-folio script</a>
  copying back the last full harvest and doing only an import:</p>
</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sudo<span class="w"> </span>screen
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>pc-full-import<span class="w"> </span>catalog-prod<span class="w"> </span>--yes<span class="w"> </span>--debug<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/mnt/shared/logs/catalog-prod-import_<span class="k">$(</span>date<span class="w"> </span>-I<span class="k">)</span>.log
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<h3 id="verification">Verification</h3>
<p>This section includes some things that should be checked after doing
a VuFind upgrade.</p>
<ul>
<li>
<p>Inside the container, execute <code>run-tests</code> to make sure all tests and linting
  checks are passing.</p>
</li>
<li>
<p>Import course reserves (via the optional CI job) to make sure that searching
  and display continues to work.</p>
</li>
<li>
<p>Verify that the "bound with" relationships are still working as expected.
  Here are some sample records from our environment:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>https://catalog.lib.msu.edu/Record/folio.in00000717323
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>https://catalog.lib.msu.edu/Record/folio.in00000336743
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>https://catalog.lib.msu.edu/Record/folio.in00000280877
</code></pre></div>
<ul>
<li>
<p>Verify that the status displayed on the record page and search results
page matches what is in the "Get This" button status.</p>
</li>
<li>
<p>Check the login</p>
</li>
<li>
<p>Check the feedback form submits (you can check result at /mail/ on devel instances)</p>
</li>
<li>
<p>Check holdings status (Available, Checked out, ...)</p>
</li>
<li>
<p>Check import scripts</p>
</li>
<li>
<p>Check placing and canceling a request. Specifically check some "bound with"
  records that have previously had problems:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>https://catalog.lib.msu.edu/Record/folio.in00005032730
</code></pre></div>
<ul>
<li>Confirm there are no errors/warnings we should address in the VuFind
  or Apache logs</li>
</ul>
<h2 id="solr-config-schema">Solr Config &amp; Schema</h2>
<p>If it is just the Solr version that is being upgraded, then updates to
the Docker image will handle the update. But if the schema or solr config
are being updated you may need to follow these steps depending on how
significant the change. For example if the schema version changes you will
need to an empty index, but for just adding or removing a few fields, it is
fine to continue from an existing index.
You can either clear out your current index,
but this will result in downtime for your site where there
will be no results returned for a period of time, or follow the below
steps to index in the alternate collection and then
swap over to once it has completed. Just note that we currently only
have an alternate collection for <code>biblio</code> and <em>not</em> for <code>authority</code> or
<code>reserves</code>, so those will need to be cleared and have a short amount of
time when they are empty.</p>
<ul>
<li>
<p>Manually run the pipeline of with the updated VuFind version and Solr version
  up to the Build stage, canceling all of the jobs in the Deploy stage.</p>
</li>
<li>
<p>Manually update the <code>.env</code> file in <code>/home/deploy/${STACK_NAME}</code> on the first node
  in the cluster setting the <code>CI_COMMIT_SHORT_SHA</code> to the commit SHA in the pipeline
  that ran above.</p>
</li>
<li>
<p>Deploy the new build container.</p>
</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># This sample is doing it for catprod-prod</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>sudo<span class="w"> </span>-Hu<span class="w"> </span>deploy<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;docker stack deploy --with-registry-auth --detach=false -c &lt;(source &quot;/home/deploy/catprod-prod/.env&quot;; envsubst &lt; &quot;/home/deploy/catprod-prod/docker-compose.build.yml&quot;) &quot;catprod-prod-catalog&quot;&#39;</span>
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Clear the <code>biblio-build</code> collection.</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>pc-connect<span class="w"> </span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-solr_solr
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr1:8983/solr/biblio-build/update&#39;</span><span class="w"> </span>--data<span class="w"> </span><span class="s1">&#39;&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-type:text/xml; charset=utf-8&#39;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr1:8983/solr/biblio-build/update&#39;</span><span class="w"> </span>--data<span class="w"> </span><span class="s1">&#39;&lt;commit/&gt;&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-type:text/xml; charset=utf-8&#39;</span>
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Update the Solr config files on the <code>biblio-build</code> collection.</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nv">CI_COMMIT_SHORT_SHA</span><span class="o">=[</span>ENTER<span class="w"> </span>THE<span class="w"> </span>COMMIT_SHA<span class="w"> </span>USED<span class="w"> </span>IN<span class="w"> </span>THE<span class="w"> </span>.ENV<span class="w"> </span>FILE<span class="o">]</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nv">STACK_NAME</span><span class="o">=</span>catprod-prod
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>docker<span class="w"> </span>pull<span class="w"> </span>registry.gitlab.msu.edu/msu-libraries/catalog/catalog/solr:<span class="si">${</span><span class="nv">CI_COMMIT_SHORT_SHA</span><span class="si">}</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nv">id</span><span class="o">=</span><span class="k">$(</span>docker<span class="w"> </span>create<span class="w"> </span>registry.gitlab.msu.edu/msu-libraries/catalog/catalog/solr:<span class="si">${</span><span class="nv">CI_COMMIT_SHORT_SHA</span><span class="si">}</span><span class="k">)</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>docker<span class="w"> </span>cp<span class="w"> </span><span class="nv">$id</span>:/solr_confs/biblio1/conf/schema.xml<span class="w"> </span>/tmp/
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>docker<span class="w"> </span>cp<span class="w"> </span><span class="nv">$id</span>:/solr_confs/biblio1/conf/solrconfig.xml<span class="w"> </span>/tmp/
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>docker<span class="w"> </span>rm<span class="w"> </span><span class="nv">$id</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>docker<span class="w"> </span>cp<span class="w"> </span>/tmp/solrconfig.xml<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-solr_solr<span class="k">)</span>:/tmp/
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>docker<span class="w"> </span>cp<span class="w"> </span>/tmp/schema.xml<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-solr_solr<span class="k">)</span>:/tmp/
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-solr_solr<span class="k">)</span><span class="w"> </span>bash
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="c1"># LOOK UP THE CORRECT biblio BASED ON THE ALIAS!!!! (Solr Admin -&gt; Cloud -&gt; Tree -&gt; aliases.json)</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="c1">## EXAMPLE IF biblio-build = biblio2</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>solr<span class="w"> </span>zk<span class="w"> </span>cp<span class="w"> </span>/tmp/solrconfig.xml<span class="w"> </span>zk:/solr/configs/biblio2/solrconfig.xml<span class="w"> </span>-z<span class="w"> </span>zk1:2181
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>solr<span class="w"> </span>zk<span class="w"> </span>cp<span class="w"> </span>/tmp/schema.xml<span class="w"> </span>zk:/solr/configs/biblio2/schema.xml<span class="w"> </span>-z<span class="w"> </span>zk1:2181
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>curl<span class="w"> </span><span class="s2">&quot;http://solr1:8983/solr/admin/collections?action=RELOAD&amp;name=biblio2&quot;</span>
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Disable incremental FOLIO harvests, since we don't want to have to worry about
  the last harvest time getting out of sync between the two collections once we
  swap back over.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>mv<span class="w"> </span>/mnt/shared/oai/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/enabled<span class="w"> </span>/mnt/shared/oai/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/disabled
</code></pre></div>
<ul>
<li>Re-index all the FOLIO records into biblio-build.</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>screen
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>/mnt/shared/oai/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/harvest_folio_build/*
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>cp<span class="w"> </span>/mnt/shared/oai/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/harvest_folio/processed/*<span class="w"> </span>/mnt/shared/oai/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/harvest_folio_build/
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>pc-connect<span class="w"> </span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-catalog_build
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1"># Note: In another ssh window, you will need to temporarily re-enable the harvests for this</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="c1"># command to work. Disable it again as soon as it starts though.</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1"># mv /mnt/shared/oai/${STACK_NAME}/disabled /mnt/shared/oai/${STACK_NAME}/enabled</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="c1"># mv /mnt/shared/oai/${STACK_NAME}/enabled /mnt/shared/oai/${STACK_NAME}/disabled</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>pc-import-folio<span class="w"> </span>-b<span class="w"> </span>-q<span class="w"> </span>-v
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>rm<span class="w"> </span>-rf<span class="w"> </span>/mnt/shared/oai/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/harvest_folio_build/*
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Re-index all the HLM records into biblio-build.</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>screen
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>rm<span class="w"> </span>-rf<span class="w"> </span>/mnt/shared/hlm/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/harvest_hlm_build/*
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>cp<span class="w"> </span>/mnt/shared/hlm/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/harvest_hlm/processed/*.marc<span class="w"> </span>/mnt/shared/hlm/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/harvest_hlm_build/
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>cp<span class="w"> </span>/mnt/shared/hlm/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/harvest_hlm/processed/*.delete<span class="w"> </span>/mnt/shared/hlm/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/harvest_hlm_build/
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>pc-connect<span class="w"> </span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-catalog_build
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>pc-import-hlm<span class="w"> </span>-i<span class="w"> </span>-v<span class="w"> </span>-q
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>rm<span class="w"> </span>-rf<span class="w"> </span>/mnt/shared/hlm/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>/harvest_hlm_build/*
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Rebuild the spellchecking indices.</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>screen
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>pc-connect<span class="w"> </span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-catalog_build
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr1:8983/solr/biblio-build/select?q=*:*&amp;spellcheck=true&amp;spellcheck.build=true&#39;</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr2:8983/solr/biblio-build/select?q=*:*&amp;spellcheck=true&amp;spellcheck.build=true&#39;</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr3:8983/solr/biblio-build/select?q=*:*&amp;spellcheck.true&amp;spellcheck.build=true&#39;</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="nb">wait</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr1:8983/solr/biblio-build/select?q=*:*&amp;spellcheck.dictionary=basicSpell&amp;spellcheck=true&amp;spellcheck.build=true&#39;</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr2:8983/solr/biblio-build/select?q=*:*&amp;spellcheck.dictionary=basicSpell&amp;spellcheck=true&amp;spellcheck.build=true&#39;</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr3:8983/solr/biblio-build/select?q=*:*&amp;spellcheck.dictionary=basicSpell&amp;spellcheck=true&amp;spellcheck.build=true&#39;</span><span class="w"> </span><span class="p">&amp;</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="nb">wait</span>
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Swap the Solr collections.</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>pc-connect<span class="w"> </span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-solr_solr
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>curl<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;http://solr:8983/solr/admin/collections?action=LISTALIASES&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>biblio
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="c1"># This EXAMPLE sets biblio-build to biblio2, and biblio to biblio1</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c1"># biblio-build =&gt; biblio2</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="c1"># biblio       =&gt; biblio1</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr:8983/solr/admin/collections?action=CREATEALIAS&amp;name=biblio-build&amp;collections=biblio2&#39;</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr:8983/solr/admin/collections?action=CREATEALIAS&amp;name=biblio&amp;collections=biblio1&#39;</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="c1"># This EXAMPLE sets biblio-build to biblio1, and biblio to biblio2</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="c1"># biblio-build =&gt; biblio1</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="c1"># biblio       =&gt; biblio2</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr:8983/solr/admin/collections?action=CREATEALIAS&amp;name=biblio-build&amp;collections=biblio1&#39;</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr:8983/solr/admin/collections?action=CREATEALIAS&amp;name=biblio&amp;collections=biblio2&#39;</span>
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Clear out the <code>biblio-build</code> collection again to save disk space.</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>pc-connect<span class="w"> </span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-solr_solr
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr1:8983/solr/biblio-build/update&#39;</span><span class="w"> </span>--data<span class="w"> </span><span class="s1">&#39;&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-type:text/xml; charset=utf-8&#39;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr1:8983/solr/biblio-build/update&#39;</span><span class="w"> </span>--data<span class="w"> </span><span class="s1">&#39;&lt;commit/&gt;&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-type:text/xml; charset=utf-8&#39;</span>
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Clear out <code>authority</code> and <code>reserves</code> in Solr.</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>pc-connect<span class="w"> </span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-solr_solr
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr1:8983/solr/biblio-build/update&#39;</span><span class="w"> </span>--data<span class="w"> </span><span class="s1">&#39;&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-type:text/xml; charset=utf-8&#39;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>curl<span class="w"> </span><span class="s1">&#39;http://solr1:8983/solr/biblio-build/update&#39;</span><span class="w"> </span>--data<span class="w"> </span><span class="s1">&#39;&lt;commit/&gt;&#39;</span><span class="w"> </span>-H<span class="w"> </span><span class="s1">&#39;Content-type:text/xml; charset=utf-8&#39;</span>
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>
<p>Now run all the pipeline steps in Deploy stage of the pipeline.</p>
</li>
<li>
<p>Run any DB migrations.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>pc<span class="w"> </span>connect<span class="w"> </span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-catalog_catalog
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>php<span class="w"> </span>public/index.php<span class="w"> </span>upgrade/database<span class="w"> </span>-vvv
</code></pre></div>
<ul>
<li>Manually run the course reserves import.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>pc-connect<span class="w"> </span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-catalog_cron
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>vim<span class="w"> </span>/etc/cron.d/crontab
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="c1"># Update the run time for the cron-reserves.sh to right away</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1"># then after that time has passed, revert the change.</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="c1"># Logs can be viewed in /monitoring</span>
</code></pre></div>
<ul>
<li>Manually run the authority import.</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>screen
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>pc-connect<span class="w"> </span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-catalog_cron
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="nb">cd</span><span class="w"> </span>local/harvest/authority<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>processed/FULL_AUTH_D250808_0*<span class="w"> </span>.<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pc-import-authority<span class="w"> </span>-v<span class="w"> </span>-q<span class="w"> </span>-i<span class="w"> </span>-B<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>pattern<span class="w"> </span><span class="k">in</span><span class="w"> </span>EEM2508N<span class="w"> </span>EEM2509N<span class="w"> </span>EEM2510N<span class="w"> </span>EEM2511N<span class="w"> </span>EEM2512N<span class="w"> </span>EEM2601N<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>mv<span class="w"> </span>processed/<span class="si">${</span><span class="nv">pattern</span><span class="si">}</span>_*.<span class="o">[</span><span class="m">0</span>-9<span class="o">][</span><span class="m">0</span>-9<span class="o">][</span><span class="m">0</span>-9<span class="o">]</span>.xml<span class="w"> </span>.<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>pc-import-authority<span class="w"> </span>-v<span class="w"> </span>-q<span class="w"> </span>-i<span class="w"> </span>-B<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Rebuild the alphabetic browse databases (starting from the host that is set to
  build them and not do the copy
  (prod: node 1, beta: node 2, preview: node 3).</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>-f<span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-solr_cron<span class="k">)</span><span class="w"> </span>/alpha-browse.sh<span class="w"> </span>-v<span class="w"> </span>-f
</code></pre></div>
<!-- markdownlint-enable MD013 -->

<ul>
<li>Run the full import script for the <code>biblio</code> collection again (which will
  re-enable incremental harvests at the appropriate time). This needs to be
  done again in case there were any database
  migrations that would result in DB record updates to get them in sync again.</li>
</ul>
<!-- markdownlint-disable MD013 -->
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>screen
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>sudo<span class="w"> </span>-s
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>pc-full-import<span class="w"> </span><span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span><span class="w"> </span>--email<span class="w"> </span>LIB.DL.pubcat@msu.edu<span class="w"> </span>--yes<span class="w"> </span>--debug<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/mnt/shared/logs/<span class="si">${</span><span class="nv">STACK_NAME</span><span class="si">}</span>-import_<span class="k">$(</span>date<span class="w"> </span>-I<span class="k">)</span>.log
</code></pre></div>
<!-- markdownlint-enable MD013 -->












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.expand", "navigation.instant"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../javascripts/tablesort.js"></script>
      
    
  </body>
</html>